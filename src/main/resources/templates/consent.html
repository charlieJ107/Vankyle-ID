<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <title>Consent Required</title>
    <script>
        function cancelConsent() {
            document.consent_form.reset();
            document.consent_form.submit();
        }
    </script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <link th:href="@{/static/css/style.css}" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-ENjdO4Dr2bkBIFxQpeoTz1HIcje39Wm4jDKdf19U8gI4ddQ3GYNS7NTKfAdVQSZe"
            crossorigin="anonymous"></script>
    <style>
        .form-container {
            max-width: 540px;
            height: fit-content;
        }
    </style>
</head>
<body>
<main class="container d-flex justify-content-center align-items-center">
    <div class="card shadow form-container mt-5">
        <div class="card-header" th:text="#{consent.sign_in_with}">
            <img th:src="@{/static/img/logo.svg}" src="/static/img/logo.svg" alt="logo"/>
            Sign in with <span th:text="#{app.name}">Vankyle ID</span>
        </div>
        <div class="card-body">
            <h3 class="text-center" th:text="#{consent.wants_access}">
            <span class="fw-bold text-primary" th:text="${clientName}">
                Client Name
            </span>
                wants to access your
                <p th:text="#{app.name}">Vankyle ID</p>
            </h3>
            <div class="text-center">
                <img th:src="${userPicture}"
                     src="/static/img/user.svg" alt="user"/>
                <span th:text="${principle}">User Principle</span>
            </div>
            <div class="mx-2 mx-md-5">
                <p th:text="#{consent.select_what}+#{consent.can_access}">
                    Select what
                    <span class="text-primary fw-bold" th:text="${clientName}">Client Name</span>
                    can access:
                </p>
            </div>
            <form class="mx-2 mx-md-5" name="consent_form" method="post" th:action="@{/oauth2/authorize}">
                <input type="hidden" name="client_id" th:value="${clientId}">
                <input type="hidden" name="state" th:value="${state}">
                <ul class="ps-0">
                    <li class="form-check py-3 border-solid border-bottom border-top"
                        th:each="scope : ${scopesToApprove}">
                        <div class="px-3">
                            <input class="form-check-input"
                                   type="checkbox" name="scope"
                                   id="${scope.getScope_id}"
                                   th:id="${scope.getScope_id()}"
                                   th:value="${scope.getScope_id()}"
                                   th:checked="${scope.isScope_approved()}">
                            <label class="form-check-label"
                                   for="${scope.getScope_id}"
                                   th:for="${scope.getScope_id()}"
                                   th:text="${scope.getScope_name()}">
                                scope
                            </label>
                        </div>
                    </li>
                </ul>
                <p>You have already granted the following permissions to the above app:</p>
                <ul class="ps-2">
                    <li class="form-check py-3 border-solid border-bottom border-top"
                        th:each="scope:${previouslyApprovedScopes}">
                        <div class="px-3">
                            <input class="form-check-input"
                                   type="checkbox" name="scope"
                                   id="${scope.getScope_id()}"
                                   th:id="${scope.getScope_id()}"
                                   th:value="${scope.getScope_id()}"
                                   checked disabled>
                            <label class="form-check-label"
                                   for="${scope.getScope_id()}"
                                   th:for="${scope.getScope_id()}"
                                   th:text="${scope.getScope_name()}">
                                scope
                            </label>
                        </div>
                    </li>
                </ul>
                <div class="pt-3 text-center">
                    <button class="btn btn-link"
                            type="button"
                            onclick="cancelConsent()">
                        Cancel
                    </button>
                    <button class="btn btn-primary"
                            type="submit" name="submit"
                            value="approve">
                        Approve
                    </button>
                </div>
            </form>
            <div class="mt-5 mx-3">
                <h5 th:text="#{consent.make_sure_you_trust}">
                    Make sure you trust
                    <span class="text-primary fw-bold" th:text="${clientName}">
                        Client Name
                    </span>
                </h5>
                <p th:text="#{consent.description}">
                    Your consent to provide access is required. If you do not approve, click Cancel, in which case
                    no information will be shared with the app.
                </p>
            </div>
        </div>
    </div>
</main>
</body>
</html>